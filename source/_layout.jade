doctype 5
html.no-js(lang='en')
  head
    meta(charset='UTF-8')
    meta(name='description', content='TODO')
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    meta(name='viewport', content='width=device-width, initial-scale=1')
    title !{titleShort ||Â 'TODO'} | Pryv API
    link(rel='icon', href='/assets/images/favicon-black.ico', type='image/x-icon')
    link(rel='apple-touch-icon', sizes='120x120', href='/assets/images/apple-touch-icon-120x120-black.png')
    link(rel='apple-touch-icon', sizes='152x152', href='/assets/images/apple-touch-icon-152x152-black.png')
    link(rel='apple-touch-icon', sizes='180x180', href='/assets/images/apple-touch-icon-180x180-black.png')
    | <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    | <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    | <!--[if lt IE 9]>
    |   <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    |   <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    | <![endif]-->
    link(rel='stylesheet', type='text/css', href='https://fonts.googleapis.com/css?family=Roboto:400,300,500,700,400italic|Roboto+Condensed:400,300,700')
    link(rel='stylesheet', type='text/css', href='/assets/style.css')
    link(rel='stylesheet', type='text/css', href='/assets/highlight/styles/zenburn.css')

  - try { isLanding = landingPage; } catch (e) { isLanding = false; }
  - var bodyClass = (isLanding ? 'landing-page' : '') + (withTOC ? 'with-toc' : '') + (withExamples ? ' with-examples' : '')
  - var rootContainerClass = withExamples ? 'container-fluid' : ('container' + (! isLanding ? ' container-narrow' : ''))
  body(class=bodyClass)
    header#page-header
      nav.navbar.navbar-default.navbar-fixed-top(role='navigation')
        div.container-fluid
          .navbar-header
            a.navbar-brand.logo(href='/')
              img(src='/assets/images/logo-256-black.png', alt='Pryv')
            button.navbar-toggle(type='button', data-toggle='collapse', data-target='#main-nav')
              span.sr-only Toggle navigation
              span.icon-bar
              span.icon-bar
              span.icon-bar
          #main-nav.collapse.navbar-collapse
            mixin menuItem(linkId)
              - var pageData = pages[linkTo[linkId]]
              - var activeClass = id === pageData.id ? 'active' : ''
              li(class=activeClass)
                a(href='/#{pageData.id}')= pageData.titleShort

            ul.nav.navbar-nav
              +menuItem('about')
              +menuItem('concepts')
              +menuItem('reference')
              +menuItem('eventTypes')
              li.dropdown
                a.dropdown-toggle(href='#', data-toggle='dropdown') More <b class="caret"></b>
                ul.dropdown-menu
                  +menuItem('changeLog')
                  +menuItem('appsAndServices')
                  +menuItem('codeLibraries')
                  +menuItem('faq')
              //li.dropdown
                a.dropdown-toggle(href='#', data-toggle='dropdown') Guides <b class="caret"></b>
                ul.dropdown-menu
                  li
                    a(href='#') Getting started
                  li
                    a(href='#') Data modeling
              //li.dropdown
                a.dropdown-toggle(href='#', data-toggle='dropdown') Reference <b class="caret"></b>
                ul.dropdown-menu
                  +menuItem('reference')
                  +menuItem('eventTypes')
                  +menuItem('standardStructure')
              //li
                a(href='#') Blog
            .navbar-right
              p.navbar-text.version
                a(href='/#{pages[linkTo["changeLog"]].id}', title='View change log') API version: <strong>#{apiReference.version}</strong>
            if withExamples && withExamples.menu
              form.navbar-form.navbar-right
                .form-group
                  label(for='examples-format') Examples:&nbsp;
                  select#examples-format.form-control
                    option(value='json', selected='selected') Raw JSON
                    option(value='http') cURL
                    option(value='sockets') Socket.IO

    #main-wrapper(class=rootContainerClass)
      #main
        if titleFull
          h1.page-title=titleFull
        | !{yield}
      - if (withTOC)
        nav#toc
          //- content generated by TOC plugin (see below)

    footer#page-footer
      nav.navbar.navbar-default
        div.container-fluid
          #footer-nav
            ul.nav.navbar-nav
              li: a(href='mailto:developers@pryv.com') Contact us
              li: a(href='http://github.com/pryv') GitHub

    //- append scripts
    script(src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js')
    script(src='/assets/bootstrap.min.js')

    if withTOC
      script(src='/assets/js/toc.min.js')
      // TOC generation
      //- assumes all headings are within a section with just one h1 per section (the section title)
      script.
        jQuery(document).ready(function($) {
          var offset = 50;

          $('#toc').toc({
            selector: '#{tocSelectors || '#main h1:not(.page-title),#main h2'}',
            ulClass: 'nav'
          });

          $('body').scrollspy({
            target: '#toc',
            offset: offset
          });

          // fix offset when navigating
          $('#toc li a, a.toc-anchor').click(function (e) {
            e.preventDefault();
            var target = $(this).attr('href');
            window.location.hash = target;
            $(target)[0].scrollIntoView();
            if ($(window).scrollTop() + $(window).height() !== $(document).height()) {
              // only adjust when not at bottom
              scrollBy(0, -offset + 1);
            }
          });
        });

    if withExamples && withExamples.menu
      // Code examples format switch
      script.
        $(document).ready(function () {
          setExamplesFormat($('#examples-format').get(0).value);
        });
        $('#examples-format').on('change', function () {
          setExamplesFormat(this.value);
        });
        function setExamplesFormat(format) {
          var removeSelectors = [];
          ['json', 'http', 'sockets'].forEach(function(f) {
            if (format !== f) {
              removeSelectors.push('.example .tab-pane.' + f + '.active');
            }
          });
          $(removeSelectors.join(',')).removeClass("active");
          $('.example .tab-pane.' + format).addClass("active");
        }

    // Code blocks highlighting
    script(src='/assets/highlight/highlight.pack.js')
    script.
      hljs.initHighlightingOnLoad();

    // Google Analytics
    script.
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-36589447-2']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
