---
id: pryvme
parentId: getting-started
title: "Get started with Pryv.IO API"
template: default.jade
withTOC: true
---

In this tutorial, we will help you to try out and evaluate Pryv.IO API for your
projects. Throughout these steps, we will use **Pryv.me**, our [Lab platform](http://pryv.com/pryvlab/) for testing Pryv.IO API.

We will guide you through:

1. [Creating a Pryv.me User](#user-creation)
2. [Data Modelling](#data-modelling-tips)
3. [Authorizing your Application](#authorize-your-application)
4. [Using CRUD operations: Create, Read, Update, Delete](#create-read-update-delete)
5. [Managing Access](#access-management)

# Create a Pryv.me User

By registering with **Pryv.me**, you will have access to a Pryv.IO user and a fully-functional Pryv.IO environment hosted in our laboratory infrastructure, perfect for your first tests.

1. Go to the [registration page](https://sw.pryv.me/access/register.html) (click the link).
2. Fill in the form, choose [where you want to store your data](http://api.pryv.com/concepts/#servers) and click the '**Create**' button. 

That's it! You will receive a welcome email from Pryv.me with your account details.

/!\ Data in Pryv.IO has a geographical location that doesn't change. This makes it easier to control what legislations apply.

## Sign-in to Pryv.me

Go to the following address to sign-in with your Pryv.IO account:

`'https://${username}.pryv.me/#/SignIn'`

You have now access to your Pryv.me account through the Pryv.IO demo dashboard. Alternatively, just click [here](https://sw.pryv.me/access/signinhub.html), enter your username and then your password in the second step. 

As shown below, the streams for this account are listed, especially a default stream which is automatically created for you: 'Diary'.

![Pryv.me Dashboard: Streams](../images/streams_dashboard.png)

# Data Modelling Tips

The Pryv.IO data model is composed mainly of two entities: **events** and **streams**.



Here's an example of two Pryv.IO user accounts and their respective streams. Inside each stream, you can see timestamped events.

![Pryv.IO Data Model](../images/PryvIO.png)

### Events

Events are the primary unit of content in Pryv.IO. An event is a timestamped piece of typed data.

Here's an example of an event:

~~~json
{
  "streamId": "pulseOximeterApp",
  "type": "frequency/bpm",
  "content": 90,
  "time": 1528446260.693,
  "tags": [],
  "created": 1528446260.693,
  "createdBy": "cji5os3u11ntt0b40tg0xhfea",
  "modified": 1528446260.693,
  "modifiedBy": "cji5os3u11ntt0b40tg0xhfea",
  "id": "cji5pfumt1nu90b40chlpetyp"
}
~~~

[Events](http://api.pryv.com/concepts/#events) either have a type from the list of [standard event types](http://api.pryv.com/event-types/#directory) or they have an application specific type. For more details, see the [events API reference](http://api.pryv.com/reference/#event).

### Streams

Streams are the main way of encoding context for events. Every event occurs in one stream. Streams follow a hierarchical structure. They can have sub-streams and usually match either user-specific, app-specific or organizational levels (e.g. life journal, work projects) or encode data sources (e.g. apps and/or devices).

Here an example of a stream with sub-streams (children):

```json
{
  "name": "Heart",
  "parentId": null,
  "created": 1528445539.785,
  "createdBy": "cji5os3u11ntt0b40tg0xhfea",
  "modified": 1528445581.592,
  "modifiedBy": "cjhagb5up1b950b40xsbeh5yj",
  "clientData":
  {
    "pryv-browser:bgColor": "#e81034"
  },
  "id": "heart",
  "children": [
    {
      "name": "Heart Rate",
      "parentId": "heart",
      "created": 1528445684.508,
      "createdBy": "cji5os3u11ntt0b40tg0xhfea",
      "modified": 1528445684.508,
      "modifiedBy": "cji5os3u11ntt0b40tg0xhfea",
      "id": "heartRate",
      "children": [
        {
          "name": "Pulse Oximeter App",
          "parentId": "heartRate",
          "created": 1528445704.807,
          "createdBy": "cji5os3u11ntt0b40tg0xhfea",
          "modified": 1528445704.807,
          "modifiedBy": "cji5os3u11ntt0b40tg0xhfea",
          "id": "pulseOximeterApp",
          "children": []
        }
      ]
    }
  ]
}
```

Imagine an athlete who uses four applications to store data on Pryv.IO. All four applications store their data in a single account:

- **Nutrition Mobile App**: Tracks the consumption of various types of food ('calories ingested').
- **Smartwatch A**: Monitors performance during the training ('calories burned', 'pulse rate').
- **Smartwatch B**: Linked to the same application but only used to monitor the 'calories burned' outside of training.
- **Pulse Oximeter**: Used at home to check the health of the heart ('pulse rate', 'blood oxygenation / SpO2')

Here is a list of data generated by the applications and their corresponding Pryv types :

| Data | Type |
|------|:-----|
| Heart rate | `frequency/bpm` |
| Blood oxygenation | `oxygen-rate/spo2` |
| Nutrition | `energy/calories` |
| Physical activity | `energy/calories` |

Given this situation, we would recommend a streams structure similar to the following:

![Example Streams Structure](../images/example_streams.png)

This stream structure has multiple benefits:

- Provides enough context to the data and thus avoids ambiguities:
  - between food consumption ('calories ingested') and physical activity ('calories burned')
  - between consumption of different food ('foodA', 'foodB')
- Allows interoperability in the case of multiple devices that:
  - measure the same type of data through different apps ('heartRate from 'pulseOximeterApp' and 'smartwatchA')
  - use the same app but measure different parameters ('smartwatchA' : 'heartRate' and 'calories burned', 'smartwatchB' : only 'calories burned')

# Authorize your application

Continuing with our previous example we would like the pulse oximeter application to be able to provision our Pryv.me account with streams and events.

For this purpose the application first needs to request access to the Pryv.IO account. We present below two methods to generate a new access for our application, which materializes in the form of an app token.

For more information about Pryv.IO accesses [see below](#access-management).

## Use Pryv.IO Access Token Generator

The easiest way to generate an app access token is to use the Pryv Access Token Generation page.

1. Go to [the Pryv Access Token Generator: http://pryv.github.io/app-web-access](http://pryv.github.io/app-web-access)
2. Set up the required parameters
   1. Enter the Application ID ('demopryv-access')

   2. Setup the streams you want to grant access to in the permissions box
      ![Permissions Box](../images/permissions_box.png)

      ~~~json
      [
        {
          "streamId": "heart",
          "level": "manage",
          "defaultName": "Heart"
        }
      ]
      ~~~

   3. Click on '**Request Access**' button

3. Now click on '**Sign in**' button ![sign_in_button](../images/sign_in_button.png) - A new tab will open

4. Sign in with your Pryv account
   ![Sign In Dialog](../images/sign_in.png)
   A popup will open to inform you about the access you are about to grant.

5. Click on '**Accept**' button

   By accepting you consent that the 'demopryv-access' application can access the stream 'heart' with a 'manage' access-level. Since this stream doesn't exist yet, it will be automatically created and carry the name we provided in the 'defaultName' parameter above. 

   For now, you just have to understand that we are generating a token that gives enough permissions to interact with our Pryv.IO account in the scope of our example. You will learn more about accesses in [Access Management](#access-management). 

   ![Accept Button](../images/accept_button.png)

6. **Your access token has been generated.**
   ![Access Token](../images/access_token.png)

## Use your own implementation
Instead of using the token generator page, it is also possible to implement the authorization process in code and obtain an access token by following the steps below.

1. Send an access request with a `POST` call to `https://access.${domain}/access`:

  ~~~bash
  curl -X POST https://reg.pryv.me/access -H 'Content-Type: application/json' \
    -d '{
    "requestingAppId": "demopryv-access",
    "requestedPermissions": [
      {
        "streamId": "heart",
        "level": "manage",
        "defaultName": "Heart"
      }
    ],
    "languageCode": "fr",
    "returnURL": false
  }'
  ~~~

  As a response, you should receive information similar to the following :
  ~~~json
  {
      "status": "NEED_SIGNIN",
      "code": 201,
      "key": "Rp3NBpMBnkCOuuAo",
      "requestingAppId": "demopryv-access",
      "requestedPermissions": [
          {
              "streamId": "heart",
              "level": "manage",
              "defaultName": "Heart"
          }
      ],
      "url": "https://sw.pryv.me/access/access.html?lang=fr&key=Rp3NBpMBnkCOuuAo&requestingAppId=demopryv-access&returnURL=false&domain=pryv.io&registerURL=https%3A%2F%2Freg.pryv.me%3A443&requestedPermissions=%5B%7B%22streamId%22%3A%22heart%22%2C%22level%22%3A%22manage%22%2C%22defaultName%22%3A%22Heart%22%7D%5D",
      "poll": "https://reg.pryv.me:443/access/Rp3NBpMBnkCOuuAo",
      "returnURL": false,
      "poll_rate_ms": 1000
  }
  ~~~

2. Get the url parameter from the previous response and copy it into your web browser.

  ~~~raw
  https://sw.pryv.me/access/access.html?lang=fr&key=Rp3NBpMBnkCOuuAo&requestingAppId=demopryv-access&returnURL=false&domain=pryv.io&registerURL=https%3A%2F%2Freg.pryv.me%3A443&requestedPermissions=%5B%7B%22streamId%22%3A%22heart%22%2C%22level%22%3A%22manage%22%2C%22defaultName%22%3A%22Heart%22%7D%5D
  ~~~

3. Sign in with your Pryv account:

   A popup will open to inform you about the access are about to grant.

4. Click on '**Accept**' button


5. Retrieve the poll url from the previous response.

  ~~~json
  "poll": "https://reg.pryv.me:443/access/Rp3NBpMBnkCOuuAo"
  ~~~

6. Poll the access token with  `GET` calls to the polling url:

  ~~~bash
  curl -i GET https://reg.pryv.me:443/access/Rp3NBpMBnkCOuuAo
  ~~~

  Once the access is generated, you should get a response with status _Accepted_ and containing the token :
  ~~~json
  {
      "status": "ACCEPTED",
      "username": "demopryv",
      "token": "cjhj7i2821eq60b40dzcdx6gt",
      "code": 200
  }
  ~~~

This token represents the access your application has to a users account; it only expires when the user retracts his consent. You should store this token permanently and securely in your application. 

# Create, Read, Update, Delete

Now that we've generated an application token, we can use it against Pryv.IO API to manipulate data of the Pryv.me account, still based on the example of our athlete.

## Create Operations

### Streams

Let's setup the context for the Pulse Oximeter measures by attaching child streams to the 'heart' root stream.

We perform a 'POST' call to the streams route, providing the 'id' and 'name' of the stream to create and a 'parentId', the id of the parent stream.

First, we create the 'heartRate' stream :

~~~bash
curl -X POST \
  -H "Content-Type: application/json" \
  -H "Authorization: ${token}" \
  -d '{
  	"id":"heartRate",
  	"name":"Heart Rate",
  	"parentId":"heart"
	}' \
  'https://${username}.${domain}/streams'
~~~

Do the same for the 'pulseOximeterApp' stream:

~~~bash
curl -X POST \
  -H "Content-Type: application/json" \
  -H "Authorization: ${token}" \
  -d '{
  	"id":"pulseOximeterApp",
  	"name":"Pulse Oximeter App",
  	"parentId":"heartRate"
	}' \
	'https://${username}.${domain}/streams'
~~~

### Events

Once the streams have been created, we can collect the Pulse Oximeter measures as events.

Create an event of type 'frequency/bpm' with a pulse rate (integer) as content in the Stream 'pulseOximeterApp'.

~~~bash
curl -X POST \
	-H "Content-Type: application/json" \
	-H "Authorization: ${token}" \
  -d '{
		"streamId": "pulseOximeterApp",
		"type": "frequency/bpm",
		"content": 90
	}' \
	'https://${username}.${domain}/events'
~~~

## Read Operations

### Streams

Use a 'GET' call to retrieve the heart stream and its childrens.

~~~bash
curl -i -H "Authorization: ${token}" \
	https://${username}.${domain}/streams
~~~

Response:

~~~json
{
  "streams": [
    {
      "name": "Heart",
      "created": 1528445539.785,
      "createdBy": "cji5os3u11ntt0b40tg0xhfea",
      "modified": 1528445581.592,
      "modifiedBy": "cjhagb5up1b950b40xsbeh5yj",
      "clientData": {
        "pryv-browser:bgColor": "#e81034"
      },
      "id": "heart",
      "children": [
        {
          "name": "Heart Rate",
          "parentId": "heart",
          "created": 1528445684.508,
          "createdBy": "cji5os3u11ntt0b40tg0xhfea",
          "modified": 1528445684.508,
          "modifiedBy": "cji5os3u11ntt0b40tg0xhfea",
          "id": "heartRate",
          "children": [
            {
              "name": "Pulse Oximeter App",
              "parentId": "heartRate",
              "created": 1528445704.807,
              "createdBy": "cji5os3u11ntt0b40tg0xhfea",
              "modified": 1528815172.551,
              "modifiedBy": "cji5os3u11ntt0b40tg0xhfea",
              "id": "pulseOximeterApp",
              "children": [
              ]
            }
          ]
        }
      ]
    }
  ],
  "meta": {
    "apiVersion": "1.2.18",
    "serverTime": 1528815903.187
  }
}
~~~


### Events

Similarly, retrieve all the Pulse Oximeter events.

~~~bash
curl 	-H "Authorization: ${token}" \
	-i https://${username}.${domain}/events
~~~

Response :

~~~json
{
  "events": [
    {
      "streamId": "pulseOximeterApp",
      "type": "frequency/bpm",
      "content": 90,
      "time": 1528447710.816,
      "tags": [
      ],
      "created": 1528447710.816,
      "createdBy": "cji5os3u11ntt0b40tg0xhfea",
      "modified": 1528447710.816,
      "modifiedBy": "cji5os3u11ntt0b40tg0xhfea",
      "id": "cji5qaxk01nui0b40ec370p94"
    }
  ],
  "meta": {
    "apiVersion": "1.2.18",
    "serverTime": 1528467864.397
    }
}
~~~

## Update Operations

### Events

Imagine we want to modify a pulse rate measure from the stream 'pulseOximeterApp':

First, retrieve the id of one event to update from the previous responses of our read operations.

~~~bash
${event_id} = cji5qaxk01nui0b40ec370p94
~~~

Then, use a 'PUT' call to update the event with a new value.

~~~bash
curl -X PUT \
  -H "Authorization: ${token}" \
  -H "Content-Type: application/json" \
  -d '{
		"content": 80
	}' \
	'https://${username}.${domain}/events/${event_id}'
~~~

### Streams

Similarly, if we want to update the stream 'pulseOximeterApp' by changing its name, we first retrieve the id of the stream we want to update.

~~~bash
${streamId} = pulseOximeterApp
~~~

Then, use a `PUT` call to update the name `Pulse Oximeter App` to `Pulse Oximeter Application`.

~~~bash
curl -X PUT \
  -H "Authorization: ${token}" \
  -H "Content-Type: application/json" \
  -d '{
		"name": "Pulse Oximeter Application"
	}' \
	'https://${username}.${domain}/streams/${streamId}'
~~~

## Delete Operations

The delete operation has two phases:

- Trash - Event/Stream disappears, but can be restored.
- Delete - Event/Stream disappears forever.

When deleting an event or a stream, it is first flagged as trashed and irreversibly deleted only when repeating the delete operation a second time.

### Events

For example, if we want to delete our Pulse Rate event, we use a 'DELETE' call to trash it first and a second same call to delete it completely.

First we retrieve the id of the event to delete.

~~~bash
${event_id} = cji5qaxk01nui0b40ec370p94
~~~

Then we trash the event (trashed=true):

~~~bash
curl -X DELETE \
  -H "Authorization: ${token}" \
  'https://${username}.${domain}/events/${event_id}'
~~~

Response:
~~~json
{
    "event": {
        "streamId": "pulseOximeterApp",
        "type": "frequency/bpm",
        "content": 105,
        "time": 1528878365.385,
        "tags": [],
        "created": 1528878365.385,
        "createdBy": "cji5os3u11ntt0b40tg0xhfea",
        "modified": 1528895740.264,
        "modifiedBy": "cjicv106i1q580b40678kjb17",
        "trashed": true,
        "id": "cjicupcqx1q530b40oao5ob02"
    },
    "meta": {
        "apiVersion": "1.2.18",
        "serverTime": 1528895740.267
    }
}
~~~

Finally, we delete the event completely. The API returns a list of deletion ids.

~~~bash
curl -X DELETE \
  -H "Authorization: ${token}" \
  'https://${username}.${domain}/events/${event_id}'
~~~

Response:

~~~json
{
    "eventDeletion": {
        "id": "cji5qaxk01nui0b40ec370p94"
    },
    "meta": {
        "apiVersion": "1.2.18",
        "serverTime": 1528817673.092
    }
}
~~~

### Streams

Now, we will delete the stream 'pulseOximeterApp'. The procedure looks like deleting an event:

~~~bash
${stream_id} = pulseOximeterApp
~~~
We repeat the following command two times, one for trashing the stream and another for deleting it :

~~~bash
curl -X DELETE \
  -H "Authorization: ${token}" \
  'https://${username}.${domain}/streams/${stream_id}'
~~~

When trying to delete the stream, you may encounter the following error message:

~~~json
{
    "error": {
        "id": "invalid-parameters-format",
        "message": "There are events referring to the deleted items and the `mergeEventsWithParent` parameter is missing."
    },
    "meta": {
        "apiVersion": "1.2.18",
        "serverTime": 1528890640.148
    }
}
~~~

This means that the stream you are trying to delete still contains some events and Pryv.IO needs to know what to do with them. You can add the 'mergeEventsWithParent' boolean as query parameter of your delete call. Set it to _true_ if you want to merge the events into the parent stream or to _false_ if you want to delete them as well.

Here is the command for deleting the stream and merging the events in the parent stream:

~~~bash
curl -X DELETE \
  -H "Authorization: ${token}" \
  'https://${username}.${domain}/streams/${streamId}?mergeEventsWithParent=true'
~~~

Response:

~~~json
{
    "streamDeletion": {
        "id": "pulseOximeterApp"
    },
    "meta": {
        "apiVersion": "1.2.18",
        "serverTime": 1528890935.505
    }
}
~~~

# Access Management

In our previous examples, we used an app token corresponding to a new access we generated at the end of the [Authorization flow](#authorize-your-application). 

Each access is defined by a 'name', a 'type' and a set of 'permissions'.

Pryv.IO distinguishes between these access types:

- *Shared*: used for person-to-person sharing. They grant access to a specific set of data and/or with limited permission levels, depending on the sharing user's choice. You will not encounter this access type in your applications.
- *App*: used by applications which don't need full, unrestricted access to the user's data. They grant access to a specific set of data and/or with limited permission levels (e.g. read-only), according to the app's needs. This is the type of access we used for our Pulse Oximeter application.
- *Personal*: used by applications that need to access to the entirety of the user's data and/or manage account settings.

Each permission specifies a 'streamId', the id of the stream to which we want to give access, and an access 'level', which can be one of the following:

- `'read'`: Enable users to view the stream and its contents (sub-streams and events).
- `'contribute'`: Enable users to contribute to one or multiple events of the stream. Cannot create, update, delete and move streams.
- `'manage'`: Enable users to fully control the stream. Can create, update, delete and move the stream.

Finally, note that an existing access can be used to create other accesses, but only if the new access has lower permissions (Shared < App < Personal and Read < Contribute < Manage). Also, an access can create other accesses only in the same scope, namely with permissions on the same streams and their childrens.

# What Next?

This concludes our first tour of Pryv.IO and some basic things you can do with it. Where to go from here? 

* Our [Java](../java/) and [Javascript](../javascript/) Getting Started guides will show the same operations using one of these languages respectively. 
* The [API Reference](../../reference/) explains all calls you can make to Pryv.IO and their parameters. 
* To obtain your own Pryv.IO installation, please get in contact with our [Sales Team](mailto:sales@pryv.com).