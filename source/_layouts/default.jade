doctype 5
html.no-js(lang='en')
  head
    meta(charset='UTF-8')
    meta(name='description', content='TODO')
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    meta(name='viewport', content='width=device-width, initial-scale=1')
    title Pryv API - !{title ||Â 'TODO'}
    link(rel='stylesheet', type='text/css', href='bootstrap/css/bootstrap.min.css')
    | <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    | <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    | <!--[if lt IE 9]>
    |   <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    |   <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    | <![endif]-->
    link(rel='stylesheet', type='text/css', href='http://fonts.googleapis.com/css?family=PT+Sans')
    link(rel='stylesheet', type='text/css', href='fonts/stylesheet.css')
    link(rel='stylesheet', type='text/css', href='style.css')
    link(rel='stylesheet', type='text/css', href='highlight.css')

  - var bodyClass = (withTOC ? 'with-toc' : '') + (withExamples ? ' with-examples' : '')
  - var rootContainerClass = withExamples ? 'container-fluid' : 'container'
  - var isLanding = false;
  - try { isLanding = landingPage; } catch (e) {}
  - if (isLanding) bodyClass += 'landing-page'
  body(class=bodyClass)
    header#page-header
      nav.navbar.navbar-default.navbar-fixed-top(role='navigation')
        div(class=rootContainerClass)
          .navbar-header
            a.navbar-brand.logo(href='dev-index.html')
              img(src='images/LogoPrYvDigital-API.png', alt='Pryv')
            button.navbar-toggle(type='button', data-toggle='collapse', data-target='#main-nav')
              span.sr-only Toggle navigation
              span.icon-bar
              span.icon-bar
              span.icon-bar
          #main-nav.collapse.navbar-collapse
            ul.nav.navbar-nav
              //- TODO: generate this menu from data
              li
                a(href='#{meta.pages.linkTo("about")}') About
              li
                a(href='#{meta.pages.linkTo("concepts")}') Concepts
              li
                a(href='#{meta.pages.linkTo("reference")}') API reference
              li
                a(href='#{meta.pages.linkTo("eventTypes")}') Event types
              li
                a(href='#{meta.pages.linkTo("appAccess")}') App access
              li.dropdown
                a.dropdown-toggle(href='#', data-toggle='dropdown') More <b class="caret"></b>
                ul.dropdown-menu
                  li
                    a(href='#{meta.pages.linkTo("appsAndServices")}') Pryv apps and services
                  li
                    a(href='#{meta.pages.linkTo("codeLibraries")}') Code libraries
              //li.dropdown
                a.dropdown-toggle(href='#', data-toggle='dropdown') Guides <b class="caret"></b>
                ul.dropdown-menu
                  li
                    a(href='#') Getting started
                  li
                    a(href='#') Data modeling
              //li.dropdown
                a.dropdown-toggle(href='#', data-toggle='dropdown') Reference <b class="caret"></b>
                ul.dropdown-menu
                  li
                    a(href='#{meta.pages.linkTo("reference")}') API
                  li
                    a(href='#{meta.pages.linkTo("eventTypes")}') Event types
                  li
                    a(href='#{meta.pages.linkTo("standardStructure")}') Standard data structure
                  li
                    a(href='#{meta.pages.linkTo("appAccess")}') App authorization
              //li
                a(href='#') Blog
            p.navbar-text.navbar-right.version API version: <strong>#{apiReference.version}</strong>
            if withExamples && withExamples.menu
              form.navbar-form.navbar-right
                .form-group
                  label(for='examples-format') Examples:
                  select#examples-format.form-control
                    option(value='json', selected='selected') Raw JSON
                    option(value='http') cURL
                    option(value='sockets') Socket.IO

    #main-wrapper(class=rootContainerClass)
      #main!= yield
      - if (withTOC)
        #toc
          //- content generated by TOC plugin (see below)

    //- append scripts
    script(src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js')
    script(src='scripts/jquery.toc.min.js')
    script(src='bootstrap/js/bootstrap.min.js')

    if withTOC
      // TOC generation
      //- assumes all headings are within a section with just one h1 per section (the section title)
      script.
        jQuery(document).ready(function($) {
          $('#toc').toc({
            'selectors': '#{tocSelectors || 'h1,h2'}',
            'container': '#main',
            'smoothScrolling': false,
            'prefix': 'toc',
            'onHighlight': function(el) {},
            'highlightOnScroll': true,
            'highlightOffset': 100,
            'anchorName': function(i, heading, prefix) {
              var $heading = $(heading),
              sectionId = $heading.parents('section[id]').attr('id');
              return sectionId + ($heading.is('h1') ? '' : '-' + slugify($heading.text()));
            },
            'headerText': function(i, heading, $heading) {
              return $heading.text();
            }
          });
          function slugify(text) {
            return text.toLowerCase().replace(/[^\w- ]+/g,'').replace(/ +/g,'-');
          }
        });

    if withExamples && withExamples.menu
      // Code examples format switch
      script.
        $(document).ready(function () {
          setExamplesFormat($('#examples-format').get(0).value);
        });
        $('#examples-format').on('change', function () {
          setExamplesFormat(this.value);
        });
        function setExamplesFormat(format) {
          var removeSelectors = [];
          ['json', 'http', 'sockets'].forEach(function(f) {
            if (format !== f) {
              removeSelectors.push('.example .tab-pane.' + f + '.active');
            }
          });
          $(removeSelectors.join(',')).removeClass("active");
          $('.example .tab-pane.' + format).addClass("active");
        }

    // Code blocks highlighting
    script(src='highlight/highlight.pack.js')
    script.
      hljs.initHighlightingOnLoad();

    // Google Analytics
    script.
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-36589447-2']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
