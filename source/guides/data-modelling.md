---
id: data-modelling
title: 'Data Modelling'
template: default.jade
customer: true
withTOC: true
---

In the following section, you will find all the necessary information to design your own model and implement it under Pryv's conventions.
We describe two basic end uses : data collection to store and aggregate data from multiple data sources for a subject, and consent aggregation of multiple subjects that granted permission to access their data.

### Data collection

Let's take the case of an athlete who uses four applications to store data on Pryv.io. All four applications store their data in a single account:

- **Nutrition Mobile App**: Tracks the consumption of various types of food ('calories ingested').
- **Smartwatch A**: Monitors performance during the training ('calories burned', 'pulse rate').
- **Smartwatch B**: Linked to the same application but only used to monitor the 'calories burned' outside of training.
- **Pulse Oximeter**: Used at home to check the health of the heart ('pulse rate', 'blood oxygenation / SpO2')

Here is a list of data generated by the applications and their corresponding Pryv types :

| Data              | Type               |
| :---------------- | :----------------- |
| Heart rate        | `frequency/bpm`    |
| Blood oxygenation | `oxygen-rate/spo2` |
| Nutrition         | `energy/calories`  |
| Physical activity | `energy/calories`  |

One general rule to remember is to have one stream or substream per device.
Given this situation, we would recommend a stream structure similar to the following :

![Example Streams Structure](/assets/images/getting-started/streams_structure_v1.png)

This stream structure has multiple benefits:

- Provides enough context to the data and thus avoids ambiguities:
  - between food consumption ('calories ingested') and physical activity ('calories burned')
  - between consumption of different food ('foodA', 'foodB')
- Allows interoperability in the case of multiple devices that:
  - measure the same type of data through different apps ('heartRate from 'pulseOximeterApp' and 'smartwatchA')
  - use the same app but measure different parameters ('smartwatchA' : 'heartRate' and 'calories burned', 'smartwatchB' : only 'calories burned')

To implement it, you will first need to create the root streams 'heart', 'blood', etc and then the corresponding substreams, in which you will be able to insert the events. You can find out more on how to create streams [here](/guides/manipulate-streams).

Alternatively, you can also do a ["batch call"](http://api.pryv.com/reference/#call-batch) to create all the streams at once. A batch call is indicated when you need to send a batch of API methods calls in one go (e.g. for syncing offline changes when resuming connectivity, for creating the streams structure, etc). In the parameter "method", you define the API method that you want to call and the object/array on which you apply it.

In our case :
```json
[
  {
    "method": "streams.create",
    "params": {
      "id": "heart",
      "name": "Heart"
    }
  },
    {
    "method": "streams.create",
    "params": {
      "id": "heartRate",
      "parentId": "heart",
      "name": "Heart Rate"
    }
  },
  {
    "method": "streams.create",
    "params": {
      "id": "pulseOximeterApp",
      "parentId": "heartRate",
      "name": "Pulse Oximeter Application"
    }
  },
  {
    "method": "streams.create",
    "params": {
      "id": "blood",
      "name": "Blood"
    }
  }
]
```

### Consent aggregation

Now, let's imagine that you want to store the accesses of multiple subjects that gave you their consent.
You will therefore need a "campaign" stream structure which allows you to store the accesses of these accounts in order to be able to retrieve data from these accounts.

![Example Campaign Structure](/assets/images/getting-started/campaign.png)

In the stream "Campaign description" you will store the requested permissions (the "streamId" you want to access e.g. "heartRate", the level of permission e.g. "read"/"manage"/â€¦), the consent information, the app identifiers. The stream "Patient accesses" will contain the "username" and "token" for every subject that granted you access to their data.

Similarly as before, you can create the streams one by one as explained [here](/guides/manipulate-streams) or all in one by doing a "batch call" : 

```json
[
  {
    "method": "streams.create",
    "params": {
      "id": "campaign-123",
      "name": "Campaign name"
    }
  },
    {
    "method": "streams.create",
    "params": {
      "id": "campaign-123-description",
      "parentId": "campaign-123",
      "name": "Campaign description"
    }
  },
  {
    "method": "streams.create",
    "params": {
      "id": "campaign-123-patient-accesses",
      "parentId": "campaign-123",
      "name": "Patient accesses"
    }
  }
]
```
And add several events in different streams at once :

```json
[
  {
    "method": "events.create",
    "params": {
    "time": 1385046854.282,
    "streamId": "campaign-123-description",
		"type": "campaign/pryv",
    "content": {
      "requestedPermissions": {}, //...
      "consentText": "", //...
      "appId": "", //
    }
    }
  },
  {
    "method": "events.create",
    "params": {
      "time": 1385046854.282,
      "streamId": "heart",
      "type": "frequency/bpm",
      "content": 90
    }
    }
]
```

If the stream already exists, the error `item-already-exists` will be displayed (See [streams.create](https://api.pryv.com/reference/#create-stream) specific errors for more information).